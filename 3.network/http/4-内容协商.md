# 内容协商

`Accept-xxx` 与 `Content-xxx` 字段组合对，实现了客户端与服务器之间的关于body数据类型、压缩方式、字符集、编码方式等的协商；

因为上述的每一项都可以有多个选项，因此请求方可以在`Accept-xxx`字段中按照自己的实际情况，指定优先项和备选项，以及各自的权重

## 权重

在字段值中，以`,`分割备选项，在每个备选项中可以用`q=n`来指定该备选项的权重优先级， `n`的取值范围是`[0, 1]` 0 标示拒绝，1标示优先级最高，最前面的权重省略，默认标示1

```bash
Accept: text/html, application/xml; q=0.9, */*; q=0.8,
```

## 结果

服务器会根据各个`Accept-xxx`字段传递的信息，最终每一项确定一个合适的处理方式，在对应的`Content-xxx`字段中返回给客户端；

有时还会在响应头中多加一个`Vary`字段，记录服务器在响应过程中参考的请求头字段

```bash
Vary: Accept-Encoding, Accept, User-Agent
```

表示本次响应，参考了上面的三个字段

## 其他

**Vary**
Vary 字段是内容协商的结果，相当于报文的一个版本标记

同一个请求，经过内容协商之后，可能会有不同的字符集、编码、浏览器版本等；
**缓存代理必须要存储这些不同的版本，在缓存是否可以复用的时候作为判定条件之一**。

> vary 字段会影响到浏览器缓存版本
