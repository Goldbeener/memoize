# 插件

## 什么是插件系统

所谓插件是一种能允许非核心代码在运行时修改应用程序的处理方式

插件系统是一个由**实现了插件化的核心模块**，和其**配套的插件模块**组成的一种应用组织形式
其中核心模块能够独立运行并实现某种特定的功能
插件模块需要在核心模块上运行，并能在应用程序运行时修改程序的处理方式，从而增强或改变程序的处理结果

插件化能将不断扩张的功能分散在插件中，内部集中维护核心不变逻辑

## 为什么要做插件系统

它有以下几个显著好处：

+ 维护成本低，只需关注和行系统的稳定性
+ 易于协同开发，拓展功能插件开发相对独立，方便利用社区生态
+ 降低核心包的大小
+ 易于拓展，轻松开发新功能

## 插件形式

+ **约定式插件**
  + 依赖核心系统加载自身
  + 按照约定，加载指定的json、js、目录文件等内容
  + egg
+ **注入式插件**
  + 核心系统提供API或生命周期
  + 插件是一个函数，接受API集合，注定调用相关的API方法把自己的函数能力注入
  + webpack
+ **事件式插件**
  + 通过事件方式提供开发能力，监听事件
  + dom事件
  + service worker
+ **插槽式插件**
  + 比如React、Vue的组件插槽
  + 一个带插槽的组件就是一个核心系统
  + 插槽就是提供的插件出入口
  + 可以实现UI解耦，父元素不需要知道子元素的具体实例，只提供插槽位置即可

## 如何实现插件化？

在程序运行特定生命周期，暴露钩子函数，以便插件能够获取程序运行中间状态，进而修改程序处理结果

确定核心系统的基本功能，以及对外提供插件环境

**核心系统需要提供的能力**

+ **必须**确定插件注册加载方式
+ **必须**确定核心系统的生命周期和相关暴露API
+ 对插件暴露合适范围的上下文，并对不同场景的上下文做隔离
+ 确定插件的依赖关系
+ 确定插件和核心系统的通信方式

**插件生命周期流程**

1. 插件解析，找到所有需要加载的插件

+ 通过npm名
+ 通过文件名
+ 通过代码
+ 通过描述文件

2. 插件注册，绑定到指定的生命周期
3. 插件调用，特定事件、生命周期触发调用

**多思考应用的核心能力，专注核心代码的编写，通过插件化的方式拓展其他能力**
